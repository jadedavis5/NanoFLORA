// GTF_STATS subworkflow 

include { AGAT_STATISTICS } from '../../modules/AGAT'
include { AGAT_STATISTICS as AGAT_STATISTICS_CANON } from '../../modules/AGAT'
include { AGAT_STATISTICS as AGAT_STATISTICS_NONCANON } from '../../modules/AGAT'

include { GFFCOMPARE } from '../../modules/GFFCOMPARE'
include { GFFREAD_GFFTOFA; GFFREAD_CANONICAL; GFFREAD_UNSPLICED } from '../../modules/GFFREAD'
include { MAP_AND_STATS } from '../MAP_AND_STATS'
include { BASIC_REMOVE_GFF_SEQ } from '../../modules/BASIC_PROCESSES'

workflow GTF_STATS {

	take:
    	gff
	ref_annotation
	genome
	nanopore_type
		
    	main:
		AGAT_STATISTICS(gff)
		GFFCOMPARE(gff, ref_annotation)		
		GFF_TO_FA = GFFREAD_GFFTOFA(gff, genome)
		MAP_AND_STATS(GFF_TO_FA, genome, nanopore_type)
		
		//Canonical transcript splicing analysis 
		//1. Get canonical transcripts
		CANONICAL_GFF = GFFREAD_CANONICAL(gff, genome)
		CANONICAL_STATS = 	
	
		//2. Take spliced canonical out of original gff
		UNSPLICED_NONCANONICAL_GFF = BASIC_REMOVE_GFF_SEQ(gff, CANONICAL_GFF)

		//3. Take unspliced seq out of previous gff to find spliced canonical junctions 
		NONCANONICAL_GFF = GFFREAD_UNSPLICED(UNSPLICED_NONCANONICAL_GFF, genome)
		NONCANONICAL_STATS = 	
	
    	emit:
	agat = GFF_TO_FA
    	
}
